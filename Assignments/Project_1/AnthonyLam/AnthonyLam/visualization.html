<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DIGITAL RESIDUE — Visualization</title>
  <link rel="stylesheet" href="./style.css?v=1004">
</head>

<body data-page="viz">

<a class="back" href="./index.html">← BACK</a>

<h1 class="viz-title">MY SCREEN TIME</h1>
<p class="viz-sub">HOVER OVER A COLOR BLOB TO REVEAL THE SCREENTIME.</p>

<div id="blob-stage"></div>
<div id="tip" class="tip"></div>

<script src="./data.js?v=1004"></script>

<script>
const stage = document.getElementById("blob-stage");
const tip = document.getElementById("tip");

const ITEMS = (typeof APPS !== "undefined") ? APPS : [];

if (!ITEMS.length) {
  stage.innerHTML = `<p style="opacity:.7">No APPS data found in data.js.</p>`;
} else {

  const maxH = Math.max(...ITEMS.map(x => Number(x.hours || 0)), 1);
  const placed = [];
  const blobs = [];

  function tryPlace(sizePx){
    const stageRect = stage.getBoundingClientRect();
    const maxX = stageRect.width - sizePx;
    const maxY = stageRect.height - sizePx;

    for (let attempt = 0; attempt < 500; attempt++){
      const x = Math.random() * Math.max(maxX,1);
      const y = Math.random() * Math.max(maxY,1);

      const cx = x + sizePx/2;
      const cy = y + sizePx/2;

      let ok = true;
      for(const p of placed){
        const dist = Math.hypot(cx-p.cx, cy-p.cy);
        const minDist = (sizePx/2)+(p.size/2)+70;
        if(dist < minDist){ ok=false; break; }
      }

      if(ok){
        placed.push({cx,cy,size:sizePx});
        return {x,y,cx,cy};
      }
    }

    const stageRect2 = stage.getBoundingClientRect();
    const x = Math.random() * Math.max(stageRect2.width - sizePx, 1);
    const y = Math.random() * Math.max(stageRect2.height - sizePx, 1);
    return {x,y,cx:x+sizePx/2, cy:y+sizePx/2};
  }

  function setActive(activeBlob, labelText){
    if (labelText){
      tip.textContent = labelText;
      tip.style.opacity = "1";
    }

    document.querySelectorAll(".blob").forEach(b => b.classList.add("dim"));
    activeBlob.classList.remove("dim");
    activeBlob.classList.add("active");

    const a = blobs.find(o => o.el === activeBlob);
    if (!a) return;

    const strength = 170;   // higher = stronger push
    const extraGap  = 90;   // higher = more space around active blob

    blobs.forEach(o => {
      if (o.el === activeBlob) {
        o.el.style.transform = `translate(0px, 0px) scale(1.32)`;
        return;
      }

      const dx = o.cx - a.cx;
      const dy = o.cy - a.cy;
      const dist = Math.max(Math.hypot(dx, dy), 0.001);

      const radius = (a.size/2) + (o.size/2) + extraGap;
      if (dist > radius) {
        o.el.style.transform = `translate(0px, 0px) scale(0.90)`;
        return;
      }

      const t = 1 - (dist / radius);   // 0..1
      const push = strength * t;

      const ux = dx / dist;
      const uy = dy / dist;

      const tx = ux * push;
      const ty = uy * push;

      o.el.style.transform = `translate(${tx}px, ${ty}px) scale(0.88)`;
    });
  }

  function clearActive(){
    tip.style.opacity = "0";
    document.querySelectorAll(".blob")
      .forEach(b => b.classList.remove("dim","active"));

    blobs.forEach(o => {
      o.el.style.transform = `translate(0px, 0px) scale(1)`;
    });
  }

  ITEMS.forEach(item => {

    const blob = document.createElement("div");
    blob.className = "blob";

    const h = Number(item.hours || 0);
    const size = 260 + (h/maxH)*420;

    blob.style.width = size+"px";
    blob.style.height = size+"px";

    const pos = tryPlace(size);
    blob.style.left = pos.x+"px";
    blob.style.top  = pos.y+"px";

    blob.style.background =
      `radial-gradient(circle,
        ${item.color} 0%,
        rgba(255,255,255,0) 72%)`;

    stage.appendChild(blob);

    blobs.push({ el: blob, cx: pos.cx, cy: pos.cy, size });

    const label = `${item.app} — ${h.toFixed(1)} HOURS`;

    const show = () => setActive(blob, label);

    blob.addEventListener("mouseenter", show);
    blob.addEventListener("click", show);
    blob.addEventListener("touchstart", (e)=>{ e.preventDefault(); show(); }, {passive:false});

    blob.addEventListener("mouseleave", clearActive);
  });

  document.addEventListener("mousemove",(e)=>{
    tip.style.left=(e.clientX+14)+"px";
    tip.style.top =(e.clientY+14)+"px";
  });

  stage.addEventListener("click", (e)=>{
    if (e.target === stage) clearActive();
  });
}
</script>

</body>
</html>
