<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>DIGITAL RESIDUE — Visualization</title>
  <link rel="stylesheet" href="./style.css?v=1001">
</head>

<body data-page="viz">

  <a class="back" href="./index.html">← BACK</a>

  <h1 class="viz-title">MY SCREEN TIME</h1>
  <p class="viz-sub">Hover a blob to reveal the app + time.</p>

  <div id="blob-stage"></div>
  <div id="tip" class="tip"></div>

  <script src="./data.js?v=1001"></script>

  <script>
    const stage = document.getElementById("blob-stage");
    const tip = document.getElementById("tip");

    const ITEMS = (typeof APPS !== "undefined") ? APPS : [];

    if (!ITEMS.length) {
      stage.innerHTML = `<p style="opacity:.7">No APPS data found in data.js.</p>`;
    } else {
      const maxH = Math.max(...ITEMS.map(x => Number(x.hours || 0)), 1);

      // ---- place blobs without overlapping (defined ONCE) ----
      const placed = [];

      function tryPlace(sizePx){
        const stageRect = stage.getBoundingClientRect();
        const maxX = stageRect.width - sizePx;
        const maxY = stageRect.height - sizePx;

        for (let attempt = 0; attempt < 250; attempt++){
          const x = Math.random() * Math.max(maxX, 1);
          const y = Math.random() * Math.max(maxY, 1);

          const cx = x + sizePx/2;
          const cy = y + sizePx/2;

          let ok = true;
          for (const p of placed){
            const dist = Math.hypot(cx - p.cx, cy - p.cy);
            const minDist = (sizePx/2) + (p.size/2) + 18; // gap
            if (dist < minDist){ ok = false; break; }
          }

          if (ok){
            placed.push({ cx, cy, size: sizePx });
            return { x, y };
          }
        }

        // fallback if crowded
        return { x: Math.random() * Math.max(maxX, 1), y: Math.random() * Math.max(maxY, 1) };
      }

      // ---- build blobs ----
      ITEMS.forEach(item => {
        const blob = document.createElement("div");
        blob.className = "blob";

        const h = Number(item.hours || 0);

        // BIG blobs: size by time
        const size = 380 + (h / maxH) * 520;
        blob.style.width = size + "px";
        blob.style.height = size + "px";

        // no-overlap placement
        const pos = tryPlace(size);
        blob.style.left = pos.x + "px";
        blob.style.top  = pos.y + "px";

        // color-coded per app
        blob.style.background = `radial-gradient(circle,
          ${item.color} 0%,
          rgba(255,255,255,0) 70%)`;

        // hover label
        blob.addEventListener("mouseenter", () => {
          tip.textContent = `${item.app} — ${h.toFixed(1)} HOURS`;
          tip.style.opacity = "1";
        });
        blob.addEventListener("mouseleave", () => {
          tip.style.opacity = "0";
        });

        stage.appendChild(blob);
      });

      // tooltip follows mouse
      document.addEventListener("mousemove", (e) => {
        tip.style.left = (e.clientX + 14) + "px";
        tip.style.top  = (e.clientY + 14) + "px";
      });
    }
  </script>

</body>
</html>
